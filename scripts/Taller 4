clear all
set more off

*P2.1.1

* Importar datos desde Excel
import excel "C:\Users\paola\Downloads\Taller-4-Doing-Economics-main\data\raw\experimento_1.xlsx", sheet("Hoja1") firstrow clear

* Renombrar variables
rename Round rondas

rename Team jugadores

rename Playerscontributions prom_contribucion
 
rename PayoffsinthisGame prom_pagos

* Asegurar que sea numérica	
destring prom_contribucion, replace
destring prom_pagos, replace

* Calcular el promedio de la contribución por ronda
collapse (mean) prom_contribucion, by (ronda)

* Graficar la contribución promedio a lo largo de las rondas
twoway (line prom_contribucion ronda, lcolor(green) lwidth(medthick)), title("Contribución promedio a lo largo del juego") xtitle("Periodo") ytitle("Contribución promedio")



*P2.2.1

* Importar datos SIN castigo
import excel "C:\Users\paola\Downloads\Taller-4-Doing-Economics-main\data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A2:Q12) firstrow clear

* Generar variable con promedio por periodo (todas las ciudades)
egen Promedio = rowmean(Copenhagen-Melbourne)

* Renonmbrar variables
rename Period Periodo

*Conservar solo variables relevantes
keep Periodo Promedio 

*Renombrar a Promedio sin castigo
rename Promedio Prom_sin_cas

*Guardar dataset limpio
save sin_castigo, replace


* Importar datos CON castigo
import excel "C:\Users\paola\Downloads\Taller-4-Doing-Economics-main\data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A16:Q26) firstrow clear

* Generar variable con promedio por periodo (todas las ciudades)
egen Promedio = rowmean(Copenhagen-Melbourne)

* Renonmbrar variables
rename Period Periodo

*Conservar solo variables relevantes
keep Periodo Promedio

*Renombrar a Promedio con castigo
rename Promedio Prom_con_cas

* Guardar dataset limpio
save con_castigo, replace 

* Unir ambos datasets
use sin_castigo, clear
merge 1:1 Periodo using con_castigo 

* Asegurar que variables sean numéricas
destring Prom_sin_cas, replace 
destring Prom_con_cas, replace 
destring Periodo, replace 

* Graficar comparación
twoway (line Prom_sin_cas Periodo, lcolor(purple) lwidth(medthick))(line Prom_con_cas Periodo, lcolor(green) lwidth(medthick)), legend(order(1 "Sin castigo" 2 "Con castigo"))ytitle("Contribución promedio") xtitle("Período (1-10)")title("Contribuciones promedio por período")



*P2.2.2

* Conservar solo los periodos 1 y 10 (primer y último periodo del experimento)
keep if Periodo == 1 | Periodo == 10

* Graficar un gráfico de barras comparando las contribuciones promedio
graph bar (mean) Prom_sin_cas Prom_con_cas, over(Periodo) title("Contribuciones promedio en las rondas 1 y 10") ytitle("Contribución") legend(label(1 "Sin castigo") label(2 "Con castigo"))



*P2.3.2

* Datos SIN castigo
import excel "C:\Users\paola\Downloads\Taller-4-Doing-Economics-main\data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A2:Q12) firstrow clear

* Renombrar variable
rename Period Periodo

* Conservar solo Periodo 1
keep if Periodo == 1

* Renombrar todas las ciudades con prefijo "c_"
rename (Copenhagen Dnipropetrovsk Minsk StGallen Muscat Samara Zurich Boston Bonn Chengdu Seoul Riyadh Nottingham Athens Istanbul Melbourne) (c_Copenhagen c_Dnipropetrovsk c_Minsk c_StGallen c_Muscat c_Samara c_Zurich c_Boston c_Bonn c_Chengdu c_Seoul c_Riyadh c_Nottingham c_Athens c_Istanbul c_Melbourne)

* Pasar de ancho a largo
reshape long c_, i(Periodo) j(Ciudad) string

* Renombrar variable
rename c_ Contribucion

* Crear variable que indique si es sin castigo (0)
gen castigo = 0

* Guardar dataset temporal
save sin_castigo1, replace


* Datos CON castigo
import excel "C:\Users\paola\Downloads\Taller-4-Doing-Economics-main\data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A16:Q26) firstrow clear

* Renombrar variable
rename Period Periodo

* Conservar solo Periodo 1
keep if Periodo == 1

* Renombrar todas las ciudades con un prefijo común (c_)
rename (Copenhagen Dnipropetrovsk Minsk StGallen Muscat Samara Zurich Boston Bonn Chengdu Seoul Riyadh Nottingham Athens Istanbul Melbourne) (c_Copenhagen c_Dnipropetrovsk c_Minsk c_StGallen c_Muscat c_Samara c_Zurich c_Boston c_Bonn c_Chengdu c_Seoul c_Riyadh c_Nottingham c_Athens c_Istanbul c_Melbourne)

* Pasar de ancho a largo
reshape long c_, i(Periodo) j(Ciudad) string

* Renombrar la variable de contribución
rename c_ Contribucion

* Crear variable que indique con castigo (1)
gen castigo = 1

* Guardar dataset temporal
save con_castigo1, replace

* Unir y aplicar t-test

* Abrir base de sin castigo
use sin_castigo1, clear

* Unirla con la base de con castigo
append using con_castigo1

* Prueba t de diferencia de medias entre las dos condiciones (Promedio de contribuciones con castigo vs sin castigo en Periodo 1)
ttest Contribucion, by(castigo)



*P2.3.3

* Datos SIN castigo
import excel "C:\Users\paola\Downloads\Taller-4-Doing-Economics-main\data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A2:Q12) firstrow clear	

* Renombrar variable
rename Period Periodo

* Conservar solo Periodo 1
keep if Periodo == 10

* Renombrar todas las ciudades con prefijo "c_"
rename (Copenhagen Dnipropetrovsk Minsk StGallen Muscat Samara Zurich Boston Bonn Chengdu Seoul Riyadh Nottingham Athens Istanbul Melbourne) (c_Copenhagen c_Dnipropetrovsk c_Minsk c_StGallen c_Muscat c_Samara c_Zurich c_Boston c_Bonn c_Chengdu c_Seoul c_Riyadh c_Nottingham c_Athens c_Istanbul c_Melbourne)

* Pasar de ancho a largo
reshape long c_, i(Periodo) j(Ciudad) string

* Renombrar variable
rename c_ Contribucion

* Crear variable que indique si es sin castigo (0)
gen castigo = 0

* Guardar dataset temporal
save sin_castigo1, replace


* Datos CON castigo
import excel "C:\Users\paola\Downloads\Taller-4-Doing-Economics-main\data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A16:Q26) firstrow clear

* Renombrar variable
rename Period Periodo

* Conservar solo Periodo 1
keep if Periodo == 10

* Renombrar todas las ciudades con un prefijo común (c_)
rename (Copenhagen Dnipropetrovsk Minsk StGallen Muscat Samara Zurich Boston Bonn Chengdu Seoul Riyadh Nottingham Athens Istanbul Melbourne) (c_Copenhagen c_Dnipropetrovsk c_Minsk c_StGallen c_Muscat c_Samara c_Zurich c_Boston c_Bonn c_Chengdu c_Seoul c_Riyadh c_Nottingham c_Athens c_Istanbul c_Melbourne)

* Pasar de ancho a largo
reshape long c_, i(Periodo) j(Ciudad) string

* Renombrar la variable de contribución
rename c_ Contribucion

* Crear variable que indique con castigo (1)
gen castigo = 1

* Guardar dataset temporal
save con_castigo1, replace

* Unir y aplicar t-test

* Abrir base de sin castigo
use sin_castigo1, clear

* Unirla con la base de con castigo
append using con_castigo1

* Prueba t de diferencia de medias entre las dos condiciones (Promedio de contribuciones con castigo vs sin castigo en Periodo 1)
ttest Contribucion, by(castigo)


