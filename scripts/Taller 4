clear all
set more off
cd "C:\Users\Esteban\Desktop\Taller-4-Doing-Economics-main"

*P2.1.1
import excel "data\raw\experimento_1.xlsx", sheet("Hoja1") firstrow clear
rename Round rondas
rename Team jugadores
rename Playerscontributions prom_contribucion
rename PayoffsinthisGame prom_pagos
destring prom_contribucion, replace
destring prom_pagos, replace
collapse (mean) prom_contribucion, by (ronda)
twoway (line prom_contribucion ronda, lcolor(green) lwidth(medthick)), ///
    title("Contribución promedio a lo largo del juego") xtitle("Periodo") ytitle("Contribución promedio")

*P2.2.1
import excel "data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A2:Q12) firstrow clear
egen Promedio = rowmean(Copenhagen-Melbourne)
rename Period Periodo
keep Periodo Promedio
rename Promedio Prom_sin_cas
save sin_castigo, replace

import excel "data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A16:Q26) firstrow clear
egen Promedio = rowmean(Copenhagen-Melbourne)
rename Period Periodo
keep Periodo Promedio
rename Promedio Prom_con_cas
save con_castigo, replace 

use sin_castigo, clear
merge 1:1 Periodo using con_castigo
destring Prom_sin_cas, replace 
destring Prom_con_cas, replace 
destring Periodo, replace 
twoway (line Prom_sin_cas Periodo, lcolor(purple) lwidth(medthick))(line Prom_con_cas Periodo, lcolor(green) lwidth(medthick)), ///
    legend(order(1 "Sin castigo" 2 "Con castigo")) ytitle("Contribución promedio") xtitle("Período (1-10)") title("Contribuciones promedio por período")

*P2.2.2
keep if Periodo == 1 | Periodo == 10
graph bar (mean) Prom_sin_cas Prom_con_cas, over(Periodo) ///
    title("Contribuciones promedio en las rondas 1 y 10") ytitle("Contribución") ///
    legend(label(1 "Sin castigo") label(2 "Con castigo"))
	


*P2.2.3 - P2.2.5 Estadísticas descriptivas para períodos 1 y 10 con y sin castigo

* Preparar datos sin castigo
import excel "data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A2:Q12) firstrow clear
rename Period Periodo
keep if Periodo == 1 | Periodo == 10
rename (Copenhagen Dnipropetrovsk Minsk StGallen Muscat Samara Zurich Boston Bonn Chengdu Seoul Riyadh Nottingham Athens Istanbul Melbourne) ///
       (c_Copenhagen c_Dnipropetrovsk c_Minsk c_StGallen c_Muscat c_Samara c_Zurich c_Boston c_Bonn c_Chengdu c_Seoul c_Riyadh c_Nottingham c_Athens c_Istanbul c_Melbourne)
reshape long c_, i(Periodo) j(Ciudad) string
rename c_ Contribucion
gen castigo=0
tempfile sin_castigo_all
save `sin_castigo_all', replace

* Preparar datos con castigo
import excel "data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A16:Q26) firstrow clear
rename Period Periodo
keep if Periodo == 1 | Periodo == 10
rename (Copenhagen Dnipropetrovsk Minsk StGallen Muscat Samara Zurich Boston Bonn Chengdu Seoul Riyadh Nottingham Athens Istanbul Melbourne) ///
       (c_Copenhagen c_Dnipropetrovsk c_Minsk c_StGallen c_Muscat c_Samara c_Zurich c_Boston c_Bonn c_Chengdu c_Seoul c_Riyadh c_Nottingham c_Athens c_Istanbul c_Melbourne)
reshape long c_, i(Periodo) j(Ciudad) string
rename c_ Contribucion
gen castigo=1
tempfile con_castigo_all
save `con_castigo_all', replace

use `sin_castigo_all', clear
append using `con_castigo_all'

* Tablas descriptivas con sintaxis correcta Stata 17+
table (Periodo castigo), statistic(mean Contribucion) statistic(sd Contribucion) statistic(min Contribucion) statistic(max Contribucion) nformat(%6.2f)

*P2.3.2

* Datos SIN castigo
import excel "data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A2:Q12) firstrow clear

* Renombrar variable
rename Period Periodo

* Conservar solo Periodo 1
keep if Periodo == 1

* Renombrar todas las ciudades con prefijo "c_"
rename (Copenhagen Dnipropetrovsk Minsk StGallen Muscat Samara Zurich Boston Bonn Chengdu Seoul Riyadh Nottingham Athens Istanbul Melbourne) (c_Copenhagen c_Dnipropetrovsk c_Minsk c_StGallen c_Muscat c_Samara c_Zurich c_Boston c_Bonn c_Chengdu c_Seoul c_Riyadh c_Nottingham c_Athens c_Istanbul c_Melbourne)

* Pasar de ancho a largo
reshape long c_, i(Periodo) j(Ciudad) string

* Renombrar variable
rename c_ Contribucion

* Crear variable que indique si es sin castigo (0)
gen castigo = 0

* Guardar dataset temporal
save sin_castigo1, replace


* Datos CON castigo
import excel "data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A16:Q26) firstrow clear

* Renombrar variable
rename Period Periodo

* Conservar solo Periodo 1
keep if Periodo == 1

* Renombrar todas las ciudades con un prefijo común (c_)
rename (Copenhagen Dnipropetrovsk Minsk StGallen Muscat Samara Zurich Boston Bonn Chengdu Seoul Riyadh Nottingham Athens Istanbul Melbourne) (c_Copenhagen c_Dnipropetrovsk c_Minsk c_StGallen c_Muscat c_Samara c_Zurich c_Boston c_Bonn c_Chengdu c_Seoul c_Riyadh c_Nottingham c_Athens c_Istanbul c_Melbourne)

* Pasar de ancho a largo
reshape long c_, i(Periodo) j(Ciudad) string

* Renombrar la variable de contribución
rename c_ Contribucion

* Crear variable que indique con castigo (1)
gen castigo = 1

* Guardar dataset temporal
save con_castigo1, replace

* Unir y aplicar t-test

* Abrir base de sin castigo
use sin_castigo1, clear

* Unirla con la base de con castigo
append using con_castigo1

* Prueba t de diferencia de medias entre las dos condiciones (Promedio de contribuciones con castigo vs sin castigo en Periodo 1)
ttest Contribucion, by(castigo)

*P2.3.3

* Datos SIN castigo
import excel "data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A2:Q12) firstrow clear	

* Renombrar variable
rename Period Periodo

* Conservar solo Periodo 1
keep if Periodo == 10

* Renombrar todas las ciudades con prefijo "c_"
rename (Copenhagen Dnipropetrovsk Minsk StGallen Muscat Samara Zurich Boston Bonn Chengdu Seoul Riyadh Nottingham Athens Istanbul Melbourne) (c_Copenhagen c_Dnipropetrovsk c_Minsk c_StGallen c_Muscat c_Samara c_Zurich c_Boston c_Bonn c_Chengdu c_Seoul c_Riyadh c_Nottingham c_Athens c_Istanbul c_Melbourne)

* Pasar de ancho a largo
reshape long c_, i(Periodo) j(Ciudad) string

* Renombrar variable
rename c_ Contribucion

* Crear variable que indique si es sin castigo (0)
gen castigo = 0

* Guardar dataset temporal
save sin_castigo1, replace


* Datos CON castigo
import excel "data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A16:Q26) firstrow clear

* Renombrar variable
rename Period Periodo

* Conservar solo Periodo 1
keep if Periodo == 10

* Renombrar todas las ciudades con un prefijo común (c_)
rename (Copenhagen Dnipropetrovsk Minsk StGallen Muscat Samara Zurich Boston Bonn Chengdu Seoul Riyadh Nottingham Athens Istanbul Melbourne) (c_Copenhagen c_Dnipropetrovsk c_Minsk c_StGallen c_Muscat c_Samara c_Zurich c_Boston c_Bonn c_Chengdu c_Seoul c_Riyadh c_Nottingham c_Athens c_Istanbul c_Melbourne)

* Pasar de ancho a largo
reshape long c_, i(Periodo) j(Ciudad) string

* Renombrar la variable de contribución
rename c_ Contribucion

* Crear variable que indique con castigo (1)
gen castigo = 1

* Guardar dataset temporal
save con_castigo1, replace

* Unir y aplicar t-test

* Abrir base de sin castigo
use sin_castigo1, clear

* Unirla con la base de con castigo
append using con_castigo1

* Prueba t de diferencia de medias entre las dos condiciones (Promedio de contribuciones con castigo vs sin castigo en Periodo 1)
ttest Contribucion, by(castigo)

