clear all
set more off

"P2.1.1"

* Importar datos desde Excel
import excel "C:\Users\paola\Downloads\Taller-4-Doing-Economics-main\data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A2:Q12) firstrow clear

* Renombrar variables
rename Round rondas

rename Team jugadores

rename Playerscontributions prom_contribucion

rename PayoffsinthisGame prom_pagos

* Asegurar que sea numérica	
destring prom_contribucion, replace
destring prom_pagos, replace

* Calcular el promedio de la contribución por ronda
collapse (mean) prom_contribucion, by (ronda)

* Graficar la contribución promedio a lo largo de las rondas
twoway (line prom_contribucion ronda, lcolor(green) lwidth(medthick)), title("Contribución promedio a lo largo del juego") xtitle("Periodo") ytitle("Contribución promedio")



"P2.2.1"

* Importar datos SIN castigo
import excel "C:\Users\paola\Downloads\Taller-4-Doing-Economics-main\data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A2:Q12) firstrow clear

* Generar variable con promedio por periodo (todas las ciudades)
egen Promedio = rowmean(Copenhagen-Melbourne)

* Renonmbrar variables
rename Period Periodo

*Conservar solo variables relevantes
keep Periodo Promedio 

*Renombrar a Promedio sin castigo
rename Promedio Prom_sin_cas

*Guardar dataset limpio
save sin_castigo, replace


* Importar datos CON castigo
import excel "C:\Users\paola\Downloads\Taller-4-Doing-Economics-main\data\raw\experimento_2.xlsx", sheet("Public goods contributions") cellrange(A16:Q26) firstrow clear

* Generar variable con promedio por periodo (todas las ciudades)
egen Promedio = rowmean(Copenhagen-Melbourne)

* Renonmbrar variables
rename Period Periodo

*Conservar solo variables relevantes
keep Periodo Promedio

*Renombrar a Promedio con castigo
rename Promedio Prom_con_cas

* Guardar dataset limpio
save con_castigo, replace 

* Unir ambos datasets
use sin_castigo, clear
merge 1:1 Periodo using con_castigo 

* Asegurar que variables sean numéricas
destring Prom_sin_cas, replace 
destring Prom_con_cas, replace 
destring Periodo, replace 

* Graficar comparación
twoway (line Prom_sin_cas Periodo, lcolor(purple) lwidth(medthick))(line Prom_con_cas Periodo, lcolor(green) lwidth(medthick)), legend(order(1 "Sin castigo" 2 "Con castigo"))ytitle("Contribución promedio") xtitle("Período (1-10)")title("Contribuciones promedio por período")



"P2.2.2"

* Conservar solo los periodos 1 y 10 (primer y último periodo del experimento)
keep if Periodo == 1 | Periodo == 10

* Graficar un gráfico de barras comparando las contribuciones promedio
graph bar (mean) Prom_sin_cas Prom_con_cas, over(Periodo) title("Contribuciones promedio en las rondas 1 y 10") ytitle("Contribución") legend(label(1 "Sin castigo") label(2 "Con castigo"))








